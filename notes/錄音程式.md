# 錄音程式

## 技能清單

| 技能 | 功能 | 觸發方式 |
|------|------|----------|
| `/phonetts` | Telegram 錄音檔轉文字 | Telegram 推送錄音檔 |
| `/selftts` | 手動上傳錄音轉文字 | 執行指令掃描 NAS self-upload |

---

## /phonetts - Telegram 錄音轉文字

### 功能
接收 Telegram 錄音檔，自動完成：
1. 下載錄音檔至 `temp/telegram-file/`
2. Whisper 本機轉文字
3. 產生 .md 文字稿
4. 更新 index.json 索引
5. 錄音備份到 NAS `backups/`
6. 同步到 NAS `voice-sync/data/`
7. 清除本機臨時檔案

### 使用方式
```
/phonetts
```
或直接傳送錄音檔到 Telegram

### 目錄結構
```
C:\Users\linyi\.openclaw\workspace\
├── temp/
│   ├── telegram-file/            # Telegram 錄音檔
│   └── data/
│       ├── index.json            # 索引資料庫
│       └── transcripts/          # 文字稿
└── skills/phonetts/
```

---

## /selftts - 手動上傳錄音轉文字

### 功能
手動執行，掃描 NAS 並批次處理：
1. 檢查 NAS 連線（ping + SMB）
2. 掃描 `voice-sync/self-upload/` 錄音檔
3. Whisper 本機轉文字
4. 產生 .md 文字稿
5. 更新 index.json 索引
6. 錄音備份到 NAS `backups/`
7. 同步到 NAS `voice-sync/data/`
8. 清除本機臨時檔案

### 使用方式
```
/selftts
```

### NAS 資料夾結構
```
voice-sync/
├── self-upload/           # 手動上傳位置（FileStation）
├── backups/              # 錄音備份
└── data/
    ├── index.json        # 索引資料庫
    └── transcripts/      # 文字稿
```

### 錯誤回報
- **NAS斷線** - NAS 無法連線或 SMB 未掛載
- **self-upload 無檔案** - 資料夾無錄音檔

### 與 /phonetts 差異
| 項目 | /phonetts | /selftts |
|------|-----------|----------|
| 觸發 | Telegram 推送 | 手動指令 |
| 來源 | temp/telegram-file/ | NAS self-upload |
| 時機 | 收到檔案即時處理 | 執行時批次處理 |

---

## 技術細節

### Whisper 模型
```python
import whisper
model = whisper.load_model('base')
result = model.transcribe(audio_path, language='Chinese')
```

### FFmpeg 音頻轉換
```bash
ffmpeg -y -i input.m4a -ar 16000 -ac 1 -c:a pcm_s16le output.wav
```

### NAS 連線檢查
```python
import socket
socket.create_connection(('192.168.1.13', 445), timeout=3)
```

---

## 環境需求

| 項目 | 版本/需求 |
|------|-----------|
| Python | 3.x+ |
| whisper | `pip install openai-whisper` |
| FFmpeg | 已安裝 |
| NAS | Synology (SMB 存取) |

---

## 注意事項

- `/selftts` 執行一次掃描，無檔案不處理
- 每次處理完會從 `self-upload` 刪除原始檔案
- 錄音檔會備份到 NAS `backups/` 目錄
- 支援格式：m4a、mp3、wav、m4b
